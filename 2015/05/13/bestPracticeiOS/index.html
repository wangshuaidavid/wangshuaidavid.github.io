

<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>For Ref - iOS Best Practice | 之隅·王大卫</title>
  <meta name="author" content="Wang Shuai">
  
  <meta name="description" content="程序员 ios nodejs java javascript etc.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="For Ref - iOS Best Practice"/>
  <meta property="og:site_name" content="之隅·王大卫"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon" type="image/x-ico">
  <link rel="alternate" href="/atom.xml" title="之隅·王大卫" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//libs.baidu.com/jquery/1.8.0/jquery.min.js"></script>

  
<script type="text/javascript">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?53e8ecfd30f6d254979df873f9e396d0";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

</script>



</head>


<body>
  <header id="header" class="inner">
<div class="alignleft">
  <h1><a href="/">之隅·王大卫</a></h1>
  <h2><a href="/">千里の道も一歩から</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
      <li><a href="/about">关于</a></li>
    
	<li> <a href="/atom.xml">RSS</a> </li>

  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-05-13T07:54:10.000Z"><a href="/2015/05/13/bestPracticeiOS/">2015-05-13</a></time>
      
      
  
    <h1 class="title">For Ref - iOS Best Practice</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="Why?">Why?</h2><p>Getting on board with iOS can be intimidating. Neither Swift nor Objective-C are widely used elsewhere, the platform has its own names for almost everything, and it’s a bumpy road for your code to actually make it onto a physical device. This living document is here to help you, whether you’re taking your first steps in Cocoaland or you’re curious about doing things “the right way”. Everything below is just suggestions, so if you have a good reason to do something differently, by all means go for it!</p>
<a id="more"></a>
<h2 id="Contents">Contents</h2><p>If you are looking for something specific, you can jump right into the relevant section from here.</p>
<ol>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#common-libraries">Common Libraries</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#networking">Networking</a></li>
<li><a href="#assets">Assets</a></li>
<li><a href="#coding-style">Coding Style</a></li>
<li><a href="#diagnostics">Diagnostics</a></li>
<li><a href="#analytics">Analytics</a></li>
<li><a href="#building">Building</a></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#in-app-purchases-iap">In-App Purchases (IAP)</a></li>
<li><a href="#license">License</a></li>
</ol>
<h2 id="Getting_Started"><span id="getting-started">Getting Started</span></h2><h3 id="Xcode">Xcode</h3><p><a href="https://developer.apple.com/xcode/" target="_blank" rel="external">Xcode</a> is the IDE of choice for most iOS developers, and the only one officially supported by Apple. There are some alternatives, of which <a href="https://www.jetbrains.com/objc/" target="_blank" rel="external">AppCode</a> is arguably the most famous, but unless you’re already a seasoned iOS person, go with Xcode. Despite its shortcomings, it’s actually quite usable nowadays!</p>
<p>To install, simply download <a href="https://itunes.apple.com/us/app/xcode/id497799835" target="_blank" rel="external">Xcode on the Mac App Store</a>. It comes with the newest SDK and simulators, and you can install more stuff under <em>Preferences &gt; Downloads</em>.</p>
<h3 id="Project_Setup">Project Setup</h3><p>A common question when beginning an iOS project is whether to write all views in code or use Interface Builder with Storyboards or XIB files. Both are known to occasionally result in working software. However, there are a few considerations:</p>
<h4 id="Why_code?">Why code?</h4><ul>
<li>Storyboards are more prone to version conflicts due to their complex XML structure. This makes merging much harder than with code.</li>
<li>It’s easier to structure and reuse views in code, thereby keeping your codebase <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_blank" rel="external">DRY</a>.</li>
<li>All information is in one place. In Interface Builder you have to click through all the inspectors to find what you’re looking for.</li>
</ul>
<h4 id="Why_Storyboards?">Why Storyboards?</h4><ul>
<li>For the less technically inclined, Storyboards can be a great way to contribute to the project directly, e.g. by tweaking colors or layout constraints. However, this requires a working project setup and some time to learn the basics.</li>
<li>Iteration is often faster since you can preview certain changes without building the project.</li>
<li>In Xcode 6, custom fonts and UI elements are finally represented visually in Storyboards, giving you a much better idea of the final appearance while designing.</li>
<li>Starting with iOS 8, <a href="http://blog.futurice.com/adaptive-view-ios8" target="_blank" rel="external">Size Classes</a> allow you to design for different device types and screens without duplication.</li>
</ul>
<h3 id="Ignores">Ignores</h3><p>A good first step when putting a project under version control is to have a decent <code>.gitignore</code> file. That way, unwanted files (user settings, temporary files, etc.) will never even make it into your repository. Luckily, GitHub has us covered for both <a href="https://github.com/github/gitignore/blob/master/Objective-C.gitignore" target="_blank" rel="external">Objective-C</a> and <a href="https://github.com/github/gitignore/blob/master/Swift.gitignore" target="_blank" rel="external">Swift</a>.</p>
<h3 id="CocoaPods">CocoaPods</h3><p>If you’re planning on including external dependencies (e.g. third-party libraries) in your project, <a href="http://www.cocoapods.org" target="_blank" rel="external">CocoaPods</a> offers easy and fast integration. Install it like so:</p>
<p>sudo gem install cocoapods</p>
<p>To get started, move inside your iOS project folder and run</p>
<p>pod init</p>
<p>This creates a Podfile, which will hold all your dependencies in one place. After adding your dependencies to the Podfile, you run</p>
<p>pod install</p>
<p>to install the libraries and include them as part of a workspace which also holds your own project. It is generally <a href="https://www.dzombak.com/blog/2014/03/including-pods-in-source-control.html" target="_blank" rel="external">recommended to commit the installed dependencies to your own repo</a>, instead of relying on having each developer running <code>pod install</code> after a fresh checkout.</p>
<p>Note that from now on, you’ll need to open the <code>.xcworkspace</code> file instead of <code>.xcproject</code>, or your code will not compile. The command</p>
<p>pod update</p>
<p>will update all pods to the newest versions permitted by the Podfile. You can use a wealth of <a href="http://guides.cocoapods.org/syntax/podfile.html#pod" target="_blank" rel="external">operators</a> to specify your exact version requirements.</p>
<h3 id="Project_Structure">Project Structure</h3><p>To keep all those hundreds of source files ending up in the same directory, it’s a good idea to set up some folder structure depending on your architecture. For instance, you can use the following:</p>
<p>├─ Models<br>├─ Views<br>├─ Controllers<br>├─ Stores<br>├─ Helpers</p>
<p>First, create them as groups (little yellow “folders”) within the group with your project’s name in Xcode’s Project Navigator. Then, for each of the groups, link them to an actual directory in your project path by opening their File Inspector on the right, hitting the little gray folder icon, and creating a new subfolder with the name of the group in your project directory.</p>
<h4 id="Localization">Localization</h4><p>Keep all user strings in localization files right from the beginning. This is good not only for translations, but also for finding user-facing text quickly. You can add a launch argument to your build scheme to launch the app in a certain language, e.g.</p>
<p>-AppleLanguages (Finnish)</p>
<p>For more complex translations such as plural forms that depending on a number of items (e.g. “1 person” vs. “3 people”), you should use the <a href="https://developer.apple.com/library/prerelease/ios/documentation/MacOSX/Conceptual/BPInternational/StringsdictFileFormat/StringsdictFileFormat.html" target="_blank" rel="external"><code>.stringsdict</code> format</a> instead of a regular <code>localizable.strings</code> file. As soon as you’ve wrapped your head around the crazy syntax, you have a powerful tool that knows how to make plurals for “one”, some”, “few” and “many” items, as needed <a href="http://www.unicode.org/cldr/charts/latest/supplemental/language_plural_rules.html" target="_blank" rel="external">e.g. in Russian or Arabic</a>.</p>
<p>Find more information about localization in <a href="https://speakerdeck.com/hasseg/localization-practicum" target="_blank" rel="external">these presentation slides</a> from the February 2012 HelsinkiOS meetup. Most of the talk is still relevant in October 2014.</p>
<h4 id="Constants">Constants</h4><p>Keep app-wide constants in a <code>Constants.h</code> file that is included in the prefix header.</p>
<p>Instead of preprocessor macro definitions (via <code>#define</code>), use actual constants:</p>
<p>static CGFloat const XYZBrandingFontSizeSmall = 12.0f;<br>static NSString * const XYZAwesomenessDeliveredNotificationName = @”foo”;</p>
<p>Actual constants are type-safe, have more explicit scope (they’re not available in all imported/included files until undefined), cannot be redefined or undefined in later parts of the code, and are available in the debugger.</p>
<h3 id="Branching_Model">Branching Model</h3><p>Especially when distributing an app to the public (e.g. through the App Store), it’s a good idea to isolate releases to their own branch with proper tags. Also, feature work that involves a lot of commits should be done on its own branch. <a href="https://github.com/nvie/gitflow" target="_blank" rel="external"><code>git-flow</code></a> is a tool that helps you follow these conventions. It is simply a convenience wrapper around Git’s branching and tagging commands, but can help maintain a proper branching structure especially for teams. Do all development on feature branches (or on <code>develop</code> for smaller work), tag releases with the app version, and commit to master only via</p>
<p>git flow release finish <version></version></p>
<h2 id="Common_Libraries"><span id="common-libraries">Common Libraries</span></h2><p>Generally speaking, make it a conscious decision to add an external dependency to your project. Sure, this one neat library solves your problem now, but maybe later gets stuck in maintenance limbo, with the next OS version that breaks everything being just around the corner. Another scenario is that a feature only achievable with external libraries suddenly becomes part of the official APIs. In a well-designed codebase, switching out the implementation is a small effort that pays off quickly. Always consider solving the problem using Apple’s extensive (and mostly excellent) frameworks first!</p>
<p>Therefore this section has been deliberately kept rather short. The libraries featured here tend to reduce boilerplate code (e.g. Auto Layout) or solve complex problems that require extensive testing, such as date calculations. As you become more proficient with iOS, be sure to dive into the source here and there, and acquaint yourself with their underlying Apple frameworks. You’ll find that those alone can do a lot of the heavy lifting.</p>
<h3 id="AFNetworking">AFNetworking</h3><p>A perceived 99.95 percent of iOS developers use this network library. While <code>NSURLSession</code> is surprisingly powerful by itself, <a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="external">AFNetworking</a> remains unbeaten when it comes to actually managing a queue of requests, which is pretty much a requirement in any modern app.</p>
<h3 id="DateTools">DateTools</h3><p>As a general rule, <a href="https://www.youtube.com/watch?v=-5wpm-gesOY" target="_blank" rel="external">don’t write your date calculations yourself</a>. Luckily, in <a href="https://github.com/MatthewYork/DateTools" target="_blank" rel="external">DateTools</a> you get an MIT-licensed, thoroughly tested library that covers pretty much all your calendary needs.</p>
<h3 id="Auto_Layout_Libraries">Auto Layout Libraries</h3><p>If you prefer to write your views in code, chances are you’ve met either of Apple’s awkward syntaxes – the regular ‘NSLayoutConstraint’ factory or the so-called <a href="https://developer.apple.com/library/ios/documentation/userexperience/conceptual/AutolayoutPG/VisualFormatLanguage/VisualFormatLanguage.html#//apple_ref/doc/uid/TP40010853-CH3-SW1" target="_blank" rel="external">Visual Format Language</a>. The former is extremely verbose and the latter based on strings, which effectively prevents compile-time checking.</p>
<p><a href="https://www.github.com/Masonry/Masonry" target="_blank" rel="external">Masonry</a> remedies this by introducing its own DSL to make, update and replace constraints. A similar approach for Swift is taken by <a href="https://github.com/robb/Cartography" target="_blank" rel="external">Cartography</a>, which builds on the language’s powerful operator overloading features. For the more conservative, <a href="https://github.com/floriankugler/FLKAutoLayout" target="_blank" rel="external">FLKAutoLayout</a> offers a clean, but rather non-magical wrapper around the native APIs.</p>
<h2 id="Architecture"><span id="architecture">Architecture</span></h2><ul>
<li><a href="http://programmers.stackexchange.com/questions/184396/mvcs-model-view-controller-store" target="_blank" rel="external">Model-View-Controller-Store (MVCS)</a></li>
<li>This is the default Apple architecture (MVC), extended by a Store layer that vends Model instances and handles the networking, caching etc.</li>
<li>Every Store exposes to the view controllers either <code>RACSignal</code>s or <code>void</code>-returning methods with custom completion blocks</li>
<li><a href="http://www.objc.io/issue-13/mvvm.html" target="_blank" rel="external">Model-View-ViewModel (MVVM)</a></li>
<li>Motivated by “massive view controllers”: MVVM considers <code>UIViewController</code> subclasses part of the View and keeps them slim by maintaining all state in the ViewModel</li>
<li>Quite new concept for Cocoa developers, but <a href="http://cocoasamurai.blogspot.de/2013/03/basic-mvvm-with-reactivecocoa.html" target="_blank" rel="external">gaining</a> <a href="http://www.raywenderlich.com/74106/mvvm-tutorial-with-reactivecocoa-part-1" target="_blank" rel="external">traction</a></li>
<li><a href="http://www.objc.io/issue-13/viper.html" target="_blank" rel="external">View-Interactor-Presenter-Entity-Routing (VIPER)</a></li>
<li>Rather exotic architecture that might be worth looking into in larger projects, where even MVVM feels too cluttered and testability is a major concern</li>
</ul>
<h3 id="“Event”_Patterns">“Event” Patterns</h3><p>These are the idiomatic ways for components to notify others about things:</p>
<ul>
<li><strong>Delegation:</strong> <em>(one-to-one)</em> Apple uses this a lot (some would say, too much). Use when you want to communicate stuff back e.g. from a modal view.</li>
<li><strong>Callback blocks:</strong> <em>(one-to-one)</em> Allow for a more loose coupling, while keeping related code sections close to each other. Also scales better than delegation when there are many senders.</li>
<li><strong>Notification Center:</strong> <em>(one-to-many)</em> Possibly the most common way for objects to emit “events” to multiple observers. Very loose coupling — notifications can even be observed globally without reference to the dispatching object.</li>
<li><strong>Key-Value Observing (KVO):</strong> <em>(one-to-many)</em> Does not require the observed object to explicitly “emit events” as long as it is <em>Key-Value Coding (KVC)</em> compliant for the observed keys (properties). Usually not recommended due to its implicit nature and the cumbersome standard library API.</li>
<li><strong>Signals:</strong> <em>(one-to-many)</em> The centerpiece of <a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external">ReactiveCocoa</a>, they allow chaining and combining to your heart’s content, thereby offering a way out of <a href="http://elm-lang.org/learn/Escape-from-Callback-Hell.elm" target="_blank" rel="external">callback hell</a>.</li>
</ul>
<h3 id="Models">Models</h3><p>Keep your models immutable, and use them to translate the remote API’s semantics and types to your app. Github’s <a href="https://github.com/Mantle/Mantle" target="_blank" rel="external">Mantle</a> is a good choice.</p>
<h3 id="Views">Views</h3><p>When laying out your views using Auto Layout, be sure to add the following to your class:</p>
<ul>
<li>(BOOL)requiresConstraintBasedLayout<br>{<br>return YES;<br>}</li>
</ul>
<p>Otherwise you may encounter strange bugs when the system doesn’t call <code>-updateConstraints</code> as you would expect it to.</p>
<h3 id="Controllers">Controllers</h3><p>Use dependency injection, i.e. pass any required objects in as parameters, instead of keeping all state around in singletons. The latter is okay only if the state <em>really</em> is global.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ [[FooDetailsViewController alloc] initWithFoo:(Foo *)foo];</span><br></pre></td></tr></table></figure>
<h2 id="Networking"><span id="networking">Networking</span></h2><h3 id="Traditional_way:_Use_custom_callback_blocks">Traditional way: Use custom callback blocks</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// GigStore.h&#10;&#10;typedef void (^FetchGigsBlock)(NSArray *gigs, NSError *error);&#10;&#10;- (void)fetchGigsForArtist:(Artist *)artist completion:(FetchGigsBlock)completion&#10;&#10;&#10;// GigsViewController.m&#10;&#10;[[GigStore sharedStore] fetchGigsForArtist:artist completion:^(NSArray *gigs, NSError *error) &#123;&#10;if (!error) &#123;&#10;// Do something with gigs&#10;&#125;&#10;else &#123;&#10;// :(&#10;&#125;&#10;];</span><br></pre></td></tr></table></figure>
<p>This works, but can quickly lead to callback hell if you need to chain multiple requests.</p>
<h3 id="Reactive_way:_Use_RAC_signals">Reactive way: Use RAC signals</h3><p>If you find yourself in callback hell, have a look at <a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external">ReactiveCocoa (RAC)</a>. It’s a versatile and multi-purpose library that can change the way people write <a href="https://github.com/jspahrsummers/GroceryList" target="_blank" rel="external">entire apps</a>, but you can also use it sparingly where it fits the task.</p>
<p>There are good introductions to the concept of RAC (and FRP in general) on <a href="http://www.teehanlax.com/blog/getting-started-with-reactivecocoa/" target="_blank" rel="external">Teehan+Lax</a> and <a href="http://nshipster.com/reactivecocoa/" target="_blank" rel="external">NSHipster</a>.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// GigStore.h&#10;&#10;- (RACSignal *)gigsForArtist:(Artist *)artist;&#10;&#10;&#10;// GigsViewController.m&#10;&#10;[[GigStore sharedStore] gigsForArtist:artist]&#10;subscribeNext:^(NSArray *gigs) &#123;&#10;// Do something with gigs&#10;&#125; error:^(NSError *error) &#123;&#10;// :(&#10;&#125;&#10;];</span><br></pre></td></tr></table></figure>
<p>This allows us to transform or filter gigs before showing them, by combining the gig signal with other signals.</p>
<h2 id="Assets"><span id="assets">Assets</span></h2><p><a href="https://developer.apple.com/library/ios/recipes/xcode_help-image_catalog-1.0/Recipe.html" target="_blank" rel="external">Asset catalogs</a> are the best way to manage all your project’s visual assets. They can hold both universal and device-specific (iPhone 4-inch, iPhone Retina, iPad, etc.) assets and will automatically serve the correct ones for a given name. Teaching your designer(s) how to add and commit things there (Xcode has its own built-in Git client) can save a lot of time that would otherwise be spent copying stuff from emails or other channels to the codebase. It also allows them to instantly try out their changes and iterate if needed.</p>
<h3 id="Using_Bitmap_Images">Using Bitmap Images</h3><p>Asset catalogs expose only the names of image sets, abstracting away the actual file names within the set. This nicely prevents asset name conflicts, as files such as <code>button_large@2x.png</code> are now namespaced inside their image sets. However, some discipline when naming assets can make life easier:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IconCheckmarkHighlighted.png // Universal, non-Retina&#10;IconCheckmarkHighlighted@2x.png // Universal, Retina&#10;IconCheckmarkHighlighted~iphone.png // iPhone, non-Retina&#10;IconCheckmarkHighlighted@2x~iphone.png // iPhone, Retina&#10;IconCheckmarkHighlighted-568h@2x~iphone.png // iPhone, Retina, 4-inch&#10;IconCheckmarkHighlighted~ipad.png // iPad, non-Retina&#10;IconCheckmarkHighlighted@2x~ipad.png // iPad, Retina</span><br></pre></td></tr></table></figure>
<p>The modifiers <code>-568h</code>, <code>@2x</code>, <code>~iphone</code> and <code>~ipad</code> are not required per se, but having them in the file name when dragging the file to an image set will automatically place them in the right “slot”, thereby preventing assignment mistakes that can be hard to hunt down.</p>
<h3 id="Using_Vector_Images">Using Vector Images</h3><p>You can include the original <a href="http://martiancraft.com/blog/2014/09/vector-images-xcode6/" target="_blank" rel="external">vector graphics (PDFs)</a> produced by designers into the asset catalogs, and have Xcode automatically generate the bitmaps from that. This reduces the complexity of your project (the number of files to manage.)</p>
<h2 id="Coding_Style"><span id="coding-style">Coding Style</span></h2><h3 id="Naming">Naming</h3><p>Apple pays great attention to keeping naming consistent, if sometimes a bit verbose, throughout their APIs. When developing for Cocoa, you make it much easier for new people to join the project if you follow <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html" target="_blank" rel="external">Apple’s naming conventions</a>.</p>
<p>Here are some basic takeaways you can start using right away:</p>
<p>A method beginning with a <em>verb</em> indicates that it performs some side effects, but won’t return anything:<br><code>- (void)loadView;</code><br><code>- (void)startAnimating;</code></p>
<p>Any method starting with a <em>noun</em>, however, returns that object and should do so without side effects:<br><code>- (UINavigationItem *)navigationItem;</code><br><code>+ (UILabel *)labelWithText:(NSString *)text;</code></p>
<p>It pays off to keep these two as separated as possible, i.e. not perform side effects when you transform data, and vice versa. That will keep your side effects contained to smaller sections of the code, which makes it more understandable and facilitates debugging.</p>
<h3 id="Structure">Structure</h3><p><a href="http://nshipster.com/pragma/" target="_blank" rel="external">Pragma marks</a> are a great way to group your methods, especially in view controllers. Here is a common structure that works with almost any view controller:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;#import &#34;SomeModel.h&#34;&#10;#import &#34;SomeView.h&#34;&#10;#import &#34;SomeController.h&#34;&#10;#import &#34;SomeStore.h&#34;&#10;#import &#34;SomeHelper.h&#34;&#10;#import &#60;SomeExternalLibrary/SomeExternalLibraryHeader.h&#62;&#10;&#10;static NSString * const XYZFooStringConstant = @&#34;FoobarConstant&#34;;&#10;static CGFloat const XYZFooFloatConstant = 1234.5;&#10;&#10;@interface XYZFooViewController () &#60;XYZBarDelegate&#62;&#10;&#10;@property (nonatomic, copy, readonly) Foo *foo;&#10;&#10;@end&#10;&#10;@implementation XYZFooViewController&#10;&#10;#pragma mark - Lifecycle&#10;&#10;- (instancetype)initWithFoo:(Foo *)foo;&#10;- (void)dealloc;&#10;&#10;#pragma mark - View Lifecycle&#10;&#10;- (void)viewDidLoad;&#10;- (void)viewWillAppear:(BOOL)animated;&#10;&#10;#pragma mark - Layout&#10;&#10;- (void)makeViewConstraints;&#10;&#10;#pragma mark - Public Interface&#10;&#10;- (void)startFooing;&#10;- (void)stopFooing;&#10;&#10;#pragma mark - User Interaction&#10;&#10;- (void)foobarButtonTapped;&#10;&#10;#pragma mark - XYZFoobarDelegate&#10;&#10;- (void)foobar:(Foobar *)foobar didSomethingWithFoo:(Foo *)foo;&#10;&#10;#pragma mark - Internal Helpers&#10;&#10;- (NSString *)displayNameForFoo:(Foo *)foo;&#10;&#10;@end</span><br></pre></td></tr></table></figure>
<p>The most important point is to keep these consistent across your project’s classes.</p>
<h3 id="External_Style_Guides">External Style Guides</h3><p>Futurice does not have company-level guidelines for coding style. It can however be useful to peruse the Objective-C style guides of other development shops, even if some bits can be quite company-specific or opinionated:</p>
<ul>
<li><a href="https://github.com/github/objective-c-style-guide" target="_blank" rel="external">GitHub</a></li>
<li><a href="http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml" target="_blank" rel="external">Google</a></li>
<li><a href="https://github.com/NYTimes/objective-c-style-guide" target="_blank" rel="external">The New York Times</a></li>
<li><a href="https://github.com/raywenderlich/objective-c-style-guide" target="_blank" rel="external">Ray Wenderlich</a></li>
<li><a href="https://gist.github.com/soffes/812796" target="_blank" rel="external">Sam Soffes</a></li>
<li><a href="http://lukeredpath.co.uk/blog/2011/06/28/my-objective-c-style-guide/" target="_blank" rel="external">Luke Redpath</a></li>
</ul>
<h2 id="DiagnosticsDiagnostics"><span id="diagnostics">Diagnostics</span>Diagnostics</h2><h3 id="Compiler_warnings">Compiler warnings</h3><p>It is recommended that you enable as many compiler warnings as possible, and treat warnings as errors. This recommendation is justified in <a href="https://speakerdeck.com/hasseg/the-compiler-is-your-friend" target="_blank" rel="external">these presentation slides</a>. The slides also contain information on how to suppress certain warnings in specific files, or in specific sections of code.</p>
<p>In short, add at least these values to the <em>“Other Warning Flags”</em> build setting:</p>
<ul>
<li><code>-Wall</code> <em>(Enables lots of additional warnings)</em></li>
<li><code>-Wextra</code> <em>(Enables more additional warnings)</em></li>
</ul>
<p>Also enable the <em>“Treat warnings as errors”</em> build setting.</p>
<h3 id="Clang_Static_Analyzer">Clang Static Analyzer</h3><p>The Clang compiler (which Xcode uses) has a <em>static analyzer</em> that performs control and data flow analysis on your code and checks for lots of errors that the compiler cannot.</p>
<p>You can manually run the analyzer from the <em>Product → Analyze</em> menu item in Xcode.</p>
<p>The analyzer can work in either “shallow” or “deep” mode. The latter is much slower but may find more issues due to cross-function control and data flow analysis.</p>
<p>Recommendations:</p>
<ul>
<li>Enable <em>all</em> of the checks in the analyzer (by enabling all of the options in the “Static Analyzer” build setting sections)</li>
<li>Enable the <em>“Analyze during ‘Build’”</em> build setting for your release build configuration to have the analyzer run automatically during release builds. (Seriously, do this — you’re not going to remember to run it manually.)</li>
<li>Set the <em>“Mode of Analysis for ‘Analyze’”</em> build setting to <em>Shallow (faster)</em></li>
<li>Set the <em>“Mode of Analysis for ‘Build’”</em> build setting to <em>Deep</em></li>
</ul>
<h3 id="Faux_Pas"><a href="http://fauxpasapp.com/" target="_blank" rel="external">Faux Pas</a></h3><p>Created by our very own <a href="https://twitter.com/AliRantakari" target="_blank" rel="external">Ali Rantakari</a>, Faux Pas is a fabulous static error detection tool. It analyzes your codebase and finds issues you had no idea even existed. Be sure to run this before shipping any iOS (or Mac) app!</p>
<p><em>(Note: all Futurice employees get a free license to this — just ask Ali.)</em></p>
<h3 id="Debugging">Debugging</h3><p>When your app crashes, Xcode does not break into the debugger by default. To achieve this, add an exception breakpoint (click the “+” at the bottom of Xcode’s Debug Navigator) to halt execution whenever an exception is raised. In many cases, you will then see the line of code responsible for the exception. This catches any exception, even handled ones. If Xcode keeps breaking on benign exceptions in third party libraries e.g., you might be able to mitigate this by choosing <em>Edit Breakpoint</em> and setting the <em>Exception</em> drop-down to <em>Objective-C</em>.</p>
<p>For view debugging, <a href="http://revealapp.com/" target="_blank" rel="external">Reveal</a> and <a href="http://sparkinspector.com" target="_blank" rel="external">Spark Inspector</a> are two powerful visual inspectors that can save you hours of time, especially if you’re using Auto Layout and want to locate views that are collapsed or off-screen. Granted, Xcode offers <a href="https://developer.apple.com/library/ios/recipes/xcode_help-debugger/using_view_debugger/using_view_debugger.html" target="_blank" rel="external">something very similar</a> for free, but it’s iOS 8+ only and feels somewhat less polished.</p>
<h3 id="Profiling">Profiling</h3><p>Xcode comes with a profiling suite called Instruments. It contains a myriad of tools for profiling memory usage, CPU, network communications, graphics and much more. It’s a complex beast, but one of its more straight-forward use cases is tracking down memory leaks with the Allocations instrument. Simply choose <em>Product</em> &gt; <em>Profile</em> in Xcode, select the Allocations instrument, hit the Record button and filter the Allocation Summary on some useful string, like the prefix of your own app’s class names. The count in the Persistent column then tells you how many instances of each object you have. Any class for which the instance count increases indiscriminately indicates a memory leak.</p>
<p>Also good to know is that Instruments has an Automation tool for recording and playing back UI interactions as JavaScript files. <a href="https://github.com/jonathanpenn/ui-auto-monkey" target="_blank" rel="external">UI Auto Monkey</a> is a script that will use Automation to randomly pummel your app with taps, swipes and rotations which can be useful for stress/soak testing.</p>
<h2 id="Analytics"><span id="analytics">Analytics</span></h2><p>Including some analytics framework in your app is strongly recommended, as it allows you to gain insights on how people actually use it. Does feature X add value? Is button Y too hard to find? To answer these, you can send events, timings and other measurable information to a service that aggregates and visualizes them – for instance, <a href="http://www.google.com/tagmanager/" target="_blank" rel="external">Google Tag Manager</a>. The latter is more versatile than Google Analytics in that it inserts a data layer between app and Analytics, so that the data logic can be modified through a web service without having to update the app.</p>
<p>A good practice is to create a slim helper class, e.g. <code>XYZAnalyticsHelper</code>, that handles the translation from app-internal models and data formats (XYZModel, NSTimeInterval, …) to the mostly string-based data layer:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;- (void)pushAddItemEventWithItem:(XYZItem *)item editMode:(XYZEditMode)editMode&#10;&#123;&#10;NSString *editModeString = [self nameForEditMode:editMode];&#10;&#10;[self pushToDataLayer:@&#123;&#10;@&#34;event&#34;: &#34;addItem&#34;,&#10;@&#34;itemIdentifier&#34;: item.identifier,&#10;@&#34;editMode&#34;: editModeString&#10;&#125;];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>This has the additional advantage of allowing you to swap out the entire Analytics framework behind the scenes if needed, without the rest of the app noticing.</p>
<h3 id="Crash_Logs">Crash Logs</h3><p>First you should make your app send crash logs onto a server somewhere so that you can access them. You can implement this manually (using <a href="https://www.plcrashreporter.org" target="_blank" rel="external">PLCrashReporter</a> and your own backend) but it’s recommended that you use an existing service instead — for example one of the following:</p>
<ul>
<li><a href="http://www.crashlytics.com" target="_blank" rel="external">Crashlytics</a></li>
<li><a href="http://hockeyapp.net" target="_blank" rel="external">HockeyApp</a></li>
<li><a href="https://www.crittercism.com" target="_blank" rel="external">Crittercism</a></li>
<li><a href="https://mint.splunk.com" target="_blank" rel="external">Splunk MINTexpress</a></li>
</ul>
<p>Once you have this set up, ensure that you <em>save the Xcode archive (<code>.xcarchive</code>)</em> of every build you release. The archive contains the built app binary and the debug symbols (<code>dSYM</code>) which you will need to symbolicate crash reports from that particular version of your app.</p>
<h2 id="Building"><span id="building">Building</span></h2><h3 id="Build_Configurations">Build Configurations</h3><p>Even simple apps can be built in different ways. The most basic separation that Xcode gives you is that between <em>debug</em> and <em>release</em> builds. For the latter, there is a lot more optimization going on at compile time, at the expense of debugging possibilities. Apple suggests that you use the <em>debug</em> build configuration for development, and create your App Store packages using the <em>release</em> build configuration. This is codified in the default scheme (the dropdown next to the Play and Stop buttons in Xcode), which commands that <em>debug</em> be used for Run and <em>release</em> for Archive.</p>
<p>However, this is a bit too simple for real-world applications. You might – no, <a href="https://blog.futurice.com/five-environments-you-cannot-develop-without" target="_blank" rel="external"><em>should!</em></a> – have different environments for testing, staging and other activities related to your service. Each might have its own base URL, log level, bundle identifier (so you can install them side-by-side), provisioning profile and so on. Therefore a simple debug/release distinction won’t cut it. You can add more build configurations on the “Info” tab of your project settings in Xcode.</p>
<h4 id="xcconfig_files_for_build_settings"><code>xcconfig</code> files for build settings</h4><p>Typically build settings are specified in the Xcode GUI, but you can also use <em>configuration settings files</em> (“<code>.xcconfig</code> files”) for them. The benefits of using these are:</p>
<ul>
<li>You can add comments to explain things</li>
<li>You can <code>#include</code> other build settings files, which helps you avoid repeating yourself:</li>
<li>If you have some settings that apply to all build configurations, add a <code>Common.xcconfig</code> and <code>#include</code> it in all the other files</li>
<li>If you e.g. want to have a “Debug” build configuration that enables compiler optimizations, you can just <code>#include &quot;MyApp_Debug.xcconfig&quot;</code> and override one of the settings</li>
<li>Conflict resolution and merging becomes easier</li>
</ul>
<p>Find more information about this topic in <a href="https://speakerdeck.com/hasseg/xcode-configuration-files" target="_blank" rel="external">these presentation slides</a>.</p>
<h3 id="Targets">Targets</h3><p>A target resides conceptually below the project level, i.e. a project can have several targets that may override its project settings. Roughly, each target corresponds to “an app” within the context of your codebase. For instance, you could have country-specific apps (built from the same codebase) for different countries’ App Stores. Each of these will need development/staging/release builds, so it’s better to handle those through build configurations, not targets. It’s not uncommon at all for an app to only have a single target.</p>
<h3 id="Schemes">Schemes</h3><p>Schemes tell Xcode what should happen when you hit the Run, Test, Profile, Analyze or Archive action. Basically, they map each of these actions to a target and a build configuration. You can also pass launch arguments, such as the language the app should run in (handy for testing your localizations!) or set some diagnostic flags for debugging.</p>
<p>A suggested naming convention for schemes is <code>MyApp (&lt;Language&gt;) [Environment]</code>:</p>
<p>MyApp (English) [Development]<br>MyApp (German) [Development]<br>MyApp [Testing]<br>MyApp [Staging]<br>MyApp [App Store]</p>
<p>For most environments the language is not needed, as the app will probably be installed through other means than Xcode, e.g. TestFlight, and the launch argument thus be ignored anyway. In that case, the device language should be set manually to test localization.</p>
<h2 id="Deployment"><span id="deployment">Deployment</span></h2><p>Deploying software on iOS devices isn’t exactly straightforward. That being said, here are some central concepts that, once understood, will help you tremendously with it.</p>
<h3 id="Signing">Signing</h3><p>Whenever you want to run software on an actual device (as opposed to the simulator), you will need to sign your build with a <strong>certificate</strong> issued by Apple. Each certificate is linked to a private/public keypair, the private half of which resides in your Mac’s Keychain. There are two types of certificates:</p>
<ul>
<li><strong>Development certificate:</strong> Every developer on a team has their own, and it is generated upon request. Xcode might do this for you, but it’s better not to press the magic “Fix issue” button and understand what is actually going on. This certificate is needed to deploy development builds to devices.</li>
<li><strong>Distribution certificate:</strong> There can be several, but it’s best to keep it to one per organization, and share its associated key through some internal channel. This certificate is needed to ship to the App Store, or your organization’s internal “enterprise app store”.</li>
</ul>
<h3 id="Provisioning">Provisioning</h3><p>Besides certificates, there are also <strong>provisioning profiles</strong>, which are basically the missing link between devices and certificates. Again, there are two types to distinguish between development and distribution purposes:</p>
<ul>
<li><p><strong>Development provisioning profile:</strong> It contains a list of all devices that are authorized to install and run the software. It is also linked to one or more development certificates, one for each developer that is allowed to use the profile. The profile can be tied to a specific app or use a wildcard App ID (*). The latter is <a href="http://blog.jaredsinclair.com/post/116436789850/" target="_blank" rel="external">discouraged</a>, because Xcode is notoriously bad at picking the correct files for signing unless guided in the right direction. Also, certain capabilities like Push Notifications or App Groups require an explicit App ID.</p>
</li>
<li><p><strong>Distribution provisioning profile:</strong> There are three different ways of distribution, each for a different use case. Each distribution profile is linked to a distribution certificate, and will be invalid when the certificate expires.</p>
</li>
<li><strong>Ad-Hoc:</strong> Just like development profiles, it contains a whitelist of devices the app can be installed to. This type of profile can be used for beta testing on 100 devices per year. For a smoother experience and up to 1000 distinct users, you can use Apple’s newly acquired <a href="https://developer.apple.com/testflight/" target="_blank" rel="external">TestFlight</a> service. Supertop offers a good <a href="http://blog.supertop.co/post/108759935377/app-developer-friends-try-testflight" target="_blank" rel="external">summary of its advantages and issues</a>.</li>
<li><strong>App Store:</strong> This profile has no list of allowed devices, as anyone can install it through Apple’s official distribution channel. This profile is required for all App Store releases.</li>
<li><strong>Enterprise:</strong> Just like App Store, there is no device whitelist, and the app can be installed by anyone with access to the enterprise’s internal “app store”, which can be just a website with links. This profile is available only on Enterprise accounts.</li>
</ul>
<p>To sync all certificates and profiles to your machine, go to Accounts in Xcode’s Preferences, add your Apple ID if needed, and double-click your team name. There is a refresh button at the bottom, but sometimes you just need to restart Xcode to make everything show up.</p>
<h4 id="Debugging_Provisioning">Debugging Provisioning</h4><p>Sometimes you need to debug a provisioning issue. For instance, Xcode may refuse to install the build to an attached device, because the latter is not on the (development or ad-hoc) profile’s device list. In those cases, you can use Craig Hockenberry’s excellent <a href="https://github.com/chockenberry/Provisioning" target="_blank" rel="external">Provisioning</a> plugin by browsing to <code>~/Library/MobileDevice/Provisioning Profiles</code>, selecting a <code>.mobileprovision</code> file and hitting Space to launch Finder’s Quick Look feature. It will show you a wealth of information such as devices, entitlements, certificates, and the App ID.</p>
<h3 id="Uploading">Uploading</h3><p><a href="https://itunesconnect.apple.com" target="_blank" rel="external">iTunes Connect</a> is Apple’s portal for managing your apps on the App Store. To upload a build, Xcode 6 requires an Apple ID that is part of the developer account used for signing. This can make things tricky when you are part of several developer accounts and want to upload their apps, as for mysterious reasons <em>any given Apple ID can only be associated with a single iTunes Connect account</em>. One workaround is to create a new Apple ID for each iTunes Connect account you need to be part of, and use Application Loader instead of Xcode to upload the builds. That effectively decouples the building and signing process from the upload of the resulting <code>.app</code> file.</p>
<p>After uploading the build, be patient as it can take up to an hour for it to show up under the Builds section of your app version. When it appears, you can link it to the app version and submit your app for review.</p>
<h2 id="In-App_Purchases_(IAP)"><span id="in-app-purchases-iap">In-App Purchases (IAP)</span></h2><p>When validating in-app purchase receipts, remember to perform the following checks:</p>
<ul>
<li><strong>Authenticity:</strong> That the receipt comes from Apple</li>
<li><strong>Integrity:</strong> That the receipt has not been tampered with</li>
<li><strong>App match:</strong> That the app bundle ID in the receipt matches your app’s bundle identifier</li>
<li><strong>Product match:</strong> That the product ID in the receipt matches your expected product identifier</li>
<li><strong>Freshness:</strong> That you haven’t seen the same receipt ID before.</li>
</ul>
<p>Whenever possible, design your IAP system to store the content for sale server-side, and provide it to the client only in exchange for a valid receipt that passes all of the above checks. This kind of a design thwarts common piracy mechanisms, and — since the validation is performed on the server — allows you to use Apple’s HTTP receipt validation service instead of interpreting the receipt <code>PKCS #7</code> / <code>ASN.1</code> format yourself.</p>
<p>For more information on this topic, check out the <a href="http://futurice.com/blog/validating-in-app-purchases-in-your-ios-app" target="_blank" rel="external">Futurice blog: Validating in-app purchases in your iOS app</a>.</p>
<h2 id="License"><span id="license">License</span></h2><p><a href="http://www.futurice.com" target="_blank" rel="external">Futurice</a> • Creative Commons Attribution 4.0 International (CC BY 4.0)</p>
<h2 id="NetworkingMore_Ideas"><span id="networking">Networking</span>More Ideas</h2><ul>
<li>3x assets, iPhone 6 screen sizes explained</li>
<li>Add list of suggested compiler warnings</li>
<li>Ask IT about automated Jenkins build machine</li>
<li>Add section on Testing</li>
<li>Add “proven don’ts”</li>
</ul>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Article/">Article</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Ref/">Ref</a>, <a href="/tags/iOS/">iOS</a>
  </div>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



 <nav id="pagination" >
    
    <a href="/2015/05/15/SomeThingAboutiOSArchitecture/" class="alignleft prev" >上一页</a>
    
    
    <a href="/2015/05/09/AboutDLNAProject/" class="alignright next" >下一页</a>
    
    <div class="clearfix"></div>
</nav>



<section id="comment">

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"wangshuai007"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->


</section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/Article/">Article</a><small>4</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Misc/">Misc</a><small>1</small></li>
  
    <li><a href="/tags/Ref/">Ref</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>2</small></li>
  
    <li><a href="/tags/iOS/">iOS</a><small>4</small></li>
  
  </ul>
</div>


  <div class="widget tag">
<h3 class="title">简介</h3>
<ul class="entry">
<li>王帅</li>
<li>David | 程序员</li>
<li>现状：ENN</li>
<font color="blue">e-mail：wangshuaii@yeah.net</font>
</ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><section>
WangShuai | <a href="https://github.com/wangshuaidavid">My github</a>, 2015
</section>
<div class="clearfix"></div>
</footer>
  <script src="//libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body>
</html>


<a href="https://github.com/wangshuaidavid" target="_blank"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub"></a>
